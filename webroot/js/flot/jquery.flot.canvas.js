(function(l){var n,v,w,p=Object.prototype.hasOwnProperty;l.plot.plugins.push({init:function(q,x){var h=x.Canvas;null==n&&(v=h.prototype.getTextInfo,w=h.prototype.addText,n=h.prototype.render);h.prototype.render=function(){if(!q.getOptions().canvas)return n.call(this);var d=this.context,e=this._textCache;d.save();d.textBaseline="middle";for(var b in e)if(p.call(e,b)){var c=e[b],a;for(a in c)if(p.call(c,a)){var g=c[a],k=!0,m;for(m in g)if(p.call(g,m)){var f=g[m],h=f.positions,l=f.lines;k&&(d.fillStyle=
f.font.color,d.font=f.font.definition,k=!1);for(var f=0,r;r=h[f];f++)if(r.active)for(var t=0,u;u=r.lines[t];t++)d.fillText(l[t].text,u[0],u[1]);else h.splice(f--,1);0==h.length&&delete g[m]}}}d.restore()};h.prototype.getTextInfo=function(d,e,b,c,a){if(!q.getOptions().canvas)return v.call(this,d,e,b,c,a);var g,k;e=""+e;g="object"===typeof b?b.style+" "+b.variant+" "+b.weight+" "+b.size+"px "+b.family:b;c=this._textCache[d];null==c&&(c=this._textCache[d]={});k=c[g];null==k&&(k=c[g]={});a=k[e];if(null==
a){c=this.context;"object"!==typeof b&&(a=l("<div>&nbsp;</div>").css("position","absolute").addClass("string"===typeof b?b:null).appendTo(this.getTextLayer(d)),b={lineHeight:a.height(),style:a.css("font-style"),variant:a.css("font-variant"),weight:a.css("font-weight"),family:a.css("font-family"),color:a.css("color")},b.size=a.css("line-height",1).height(),a.remove());g=b.style+" "+b.variant+" "+b.weight+" "+b.size+"px "+b.family;a=k[e]={width:0,height:0,positions:[],lines:[],font:{definition:g,color:b.color}};
c.save();c.font=g;e=(e+"").replace(/<br ?\/?>|\r\n|\r/g,"\n").split("\n");for(d=0;d<e.length;++d)k=e[d],g=c.measureText(k),a.width=Math.max(g.width,a.width),a.height+=b.lineHeight,a.lines.push({text:k,width:g.width,height:b.lineHeight});c.restore()}return a};h.prototype.addText=function(d,e,b,c,a,g,k,h,f){if(!q.getOptions().canvas)return w.call(this,d,e,b,c,a,g,k,h,f);a=this.getTextInfo(d,c,a,g,k);c=a.positions;d=a.lines;b+=a.height/d.length/2;b="middle"==f?Math.round(b-a.height/2):"bottom"==f?Math.round(b-
a.height):Math.round(b);window.opera&&12>window.opera.version().split(".")[0]&&(b-=2);for(f=0;a=c[f];f++)if(a.x==e&&a.y==b){a.active=!0;return}a={active:!0,lines:[],x:e,y:b};c.push(a);for(f=0;c=d[f];f++)"center"==h?a.lines.push([Math.round(e-c.width/2),b]):"right"==h?a.lines.push([Math.round(e-c.width),b]):a.lines.push([Math.round(e),b]),b+=c.height}},options:{canvas:!0},name:"canvas",version:"1.0"})})(jQuery);
