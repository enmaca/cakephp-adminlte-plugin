(function(l){var n,u,v,p=Object.prototype.hasOwnProperty;l.plot.plugins.push({init:function(q,w){var h=w.Canvas;null==n&&(u=h.prototype.getTextInfo,v=h.prototype.addText,n=h.prototype.render);h.prototype.render=function(){if(!q.getOptions().canvas)return n.call(this);var d=this.context,e=this._textCache;d.save();d.textBaseline="middle";for(var a in e)if(p.call(e,a)){var c=e[a],b;for(b in c)if(p.call(c,b)){var g=c[b],k=!0,m;for(m in g)if(p.call(g,m)){var f=g[m],h=f.positions,l=f.lines;k&&(d.fillStyle=
f.font.color,d.font=f.font.definition,k=!1);for(var f=0,r;r=h[f];f++)if(r.active)for(var s=0,t;t=r.lines[s];s++)d.fillText(l[s].text,t[0],t[1]);else h.splice(f--,1);0==h.length&&delete g[m]}}}d.restore()};h.prototype.getTextInfo=function(d,e,a,c,b){if(!q.getOptions().canvas)return u.call(this,d,e,a,c,b);var g,k;e=""+e;g="object"===typeof a?a.style+" "+a.variant+" "+a.weight+" "+a.size+"px "+a.family:a;c=this._textCache[d];null==c&&(c=this._textCache[d]={});k=c[g];null==k&&(k=c[g]={});b=k[e];if(null==
b){c=this.context;"object"!==typeof a&&(b=l("<div>&nbsp;</div>").css("position","absolute").addClass("string"===typeof a?a:null).appendTo(this.getTextLayer(d)),a={lineHeight:b.height(),style:b.css("font-style"),variant:b.css("font-variant"),weight:b.css("font-weight"),family:b.css("font-family"),color:b.css("color")},a.size=b.css("line-height",1).height(),b.remove());g=a.style+" "+a.variant+" "+a.weight+" "+a.size+"px "+a.family;b=k[e]={width:0,height:0,positions:[],lines:[],font:{definition:g,color:a.color}};
c.save();c.font=g;e=(e+"").replace(/<br ?\/?>|\r\n|\r/g,"\n").split("\n");for(d=0;d<e.length;++d)k=e[d],g=c.measureText(k),b.width=Math.max(g.width,b.width),b.height+=a.lineHeight,b.lines.push({text:k,width:g.width,height:a.lineHeight});c.restore()}return b};h.prototype.addText=function(d,e,a,c,b,g,k,h,f){if(!q.getOptions().canvas)return v.call(this,d,e,a,c,b,g,k,h,f);b=this.getTextInfo(d,c,b,g,k);c=b.positions;d=b.lines;a+=b.height/d.length/2;a="middle"==f?Math.round(a-b.height/2):"bottom"==f?Math.round(a-
b.height):Math.round(a);window.opera&&12>window.opera.version().split(".")[0]&&(a-=2);for(f=0;b=c[f];f++)if(b.x==e&&b.y==a){b.active=!0;return}b={active:!0,lines:[],x:e,y:a};c.push(b);for(f=0;c=d[f];f++)"center"==h?b.lines.push([Math.round(e-c.width/2),a]):"right"==h?b.lines.push([Math.round(e-c.width),a]):b.lines.push([Math.round(e),a]),a+=c.height}},options:{canvas:!0},name:"canvas",version:"1.0"})})(jQuery);
