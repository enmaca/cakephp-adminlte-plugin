(function(k){k.plot.plugins.push({init:function(c){function q(b){a.active&&(r(b),c.getPlaceholder().trigger("plotselecting",[p()]))}function t(b){1==b.which&&(document.body.focus(),void 0!==document.onselectstart&&null==h.onselectstart&&(h.onselectstart=document.onselectstart,document.onselectstart=function(){return!1}),void 0!==document.ondrag&&null==h.ondrag&&(h.ondrag=document.ondrag,document.ondrag=function(){return!1}),u(a.first,b),a.active=!0,m=function(b){m=null;void 0!==document.onselectstart&&
(document.onselectstart=h.onselectstart);void 0!==document.ondrag&&(document.ondrag=h.ondrag);a.active=!1;r(b);n()?v():(c.getPlaceholder().trigger("plotunselected",[]),c.getPlaceholder().trigger("plotselecting",[null]))},k(document).one("mouseup",m))}function p(){if(!n()||!a.show)return null;var b={},f=a.first,d=a.second;k.each(c.getAxes(),function(a,c){if(c.used){var e=c.c2p(f[c.direction]),l=c.c2p(d[c.direction]);b[a]={from:Math.min(e,l),to:Math.max(e,l)}}});return b}function v(){var b=p();c.getPlaceholder().trigger("plotselected",
[b]);b.xaxis&&b.yaxis&&c.getPlaceholder().trigger("selected",[{x1:b.xaxis.from,y1:b.yaxis.from,x2:b.xaxis.to,y2:b.yaxis.to}])}function u(b,f){var d=c.getOptions(),e=c.getPlaceholder().offset(),l=c.getPlotOffset(),g=f.pageX-e.left-l.left,h=c.width();b.x=0>g?0:g>h?h:g;e=f.pageY-e.top-l.top;l=c.height();b.y=0>e?0:e>l?l:e;"y"==d.selection.mode&&(b.x=b==a.first?0:c.width());"x"==d.selection.mode&&(b.y=b==a.first?0:c.height())}function r(b){null!=b.pageX&&(u(a.second,b),n()?(a.show=!0,c.triggerRedrawOverlay()):
w(!0))}function w(b){a.show&&(a.show=!1,c.triggerRedrawOverlay(),b||c.getPlaceholder().trigger("plotunselected",[]))}function x(b,a){var d,e,f,g,h=c.getAxes(),k;for(k in h)if(d=h[k],d.direction==a&&(g=a+d.n+"axis",b[g]||1!=d.n||(g=a+"axis"),b[g])){e=b[g].from;f=b[g].to;break}b[g]||(d="x"==a?c.getXAxes()[0]:c.getYAxes()[0],e=b[a+"1"],f=b[a+"2"]);null!=e&&null!=f&&e>f&&(g=e,e=f,f=g);return{from:e,to:f,axis:d}}function n(){var b=c.getOptions().selection.minSize;return Math.abs(a.second.x-a.first.x)>=
b&&Math.abs(a.second.y-a.first.y)>=b}var a={first:{x:-1,y:-1},second:{x:-1,y:-1},show:!1,active:!1},h={},m=null;c.clearSelection=w;c.setSelection=function(b,f){var d,e=c.getOptions();"y"==e.selection.mode?(a.first.x=0,a.second.x=c.width()):(d=x(b,"x"),a.first.x=d.axis.p2c(d.from),a.second.x=d.axis.p2c(d.to));"x"==e.selection.mode?(a.first.y=0,a.second.y=c.height()):(d=x(b,"y"),a.first.y=d.axis.p2c(d.from),a.second.y=d.axis.p2c(d.to));a.show=!0;c.triggerRedrawOverlay();!f&&n()&&v()};c.getSelection=
p;c.hooks.bindEvents.push(function(b,a){null!=b.getOptions().selection.mode&&(a.mousemove(q),a.mousedown(t))});c.hooks.drawOverlay.push(function(b,c){if(a.show&&n()){var d=b.getPlotOffset(),e=b.getOptions();c.save();c.translate(d.left,d.top);d=k.color.parse(e.selection.color);c.strokeStyle=d.scale("a",.8).toString();c.lineWidth=1;c.lineJoin=e.selection.shape;c.fillStyle=d.scale("a",.4).toString();var e=Math.min(a.first.x,a.second.x)+.5,d=Math.min(a.first.y,a.second.y)+.5,f=Math.abs(a.second.x-a.first.x)-
1,g=Math.abs(a.second.y-a.first.y)-1;c.fillRect(e,d,f,g);c.strokeRect(e,d,f,g);c.restore()}});c.hooks.shutdown.push(function(b,a){a.unbind("mousemove",q);a.unbind("mousedown",t);m&&k(document).unbind("mouseup",m)})},options:{selection:{mode:null,color:"#e8cfac",shape:"round",minSize:5}},name:"selection",version:"1.1"})})(jQuery);
