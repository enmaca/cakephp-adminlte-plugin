var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,h,f){if(f.get||f.set)throw new TypeError("ES3 does not support getters and setters.");b!=Array.prototype&&b!=Object.prototype&&(b[h]=f.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(b){var h=0;return $jscomp.iteratorPrototype(function(){return h<b.length?{done:!1,value:b[h++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(b,h){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var f=0,a={next:function(){if(f<b.length){var g=f++;return{value:h(g,b[g]),done:!1}}a.next=function(){return{done:!0,value:void 0}};return a.next()}};a[Symbol.iterator]=function(){return a};return a};
$jscomp.polyfill=function(b,h,f,a){if(h){f=$jscomp.global;b=b.split(".");for(a=0;a<b.length-1;a++){var g=b[a];g in f||(f[g]={});f=f[g]}b=b[b.length-1];a=f[b];h=h(a);h!=a&&null!=h&&$jscomp.defineProperty(f,b,{configurable:!0,writable:!0,value:h})}};$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6-impl","es3");
(function(){function b(a){h.call(this,a);this.hintContainer=this.codeContainer=null}var h=ToolbarConfigurator.AbstractToolbarModifier,f=ToolbarConfigurator.FullToolbarEditor;ToolbarConfigurator.ToolbarTextModifier=b;b.prototype=Object.create(h.prototype);b.prototype._onInit=function(a,b){h.prototype._onInit.call(this,void 0,b);this._createModifier(b?this.actualConfig:void 0);"function"===typeof a&&a(this.mainContainer)};b.prototype._createModifier=function(a){function b(a){var b=c(a);if(null!==b.charsBetween){var g=
k.getUnusedButtonsArray(k.actualConfig.toolbar,!0,b.charsBetween),e=a.getCursor(),b=CodeMirror.Pos(e.line,e.ch-b.charsBetween.length),m=a.getTokenAt(e);"{"===a.getTokenAt({line:e.line,ch:m.start}).string&&(g=["name"]);if(0!==g.length)return new d(b,e,g)}}function d(a,b,c){this.from=a;this.to=b;this.list=c;this._handlers=[]}function c(a,b){var c={};c.cur=a.getCursor();c.tok=a.getTokenAt(c.cur);c["char"]=b||c.tok.string.charAt(c.tok.string.length-1);var g=a.getRange(CodeMirror.Pos(c.cur.line,0),c.cur).split("").reverse().join(""),
g=g.replace(/(['|"]\w*['|"])/g,"");c.charsBetween=g.match(/(^\w*)(['|"])/);c.charsBetween&&(c.endChar=c.charsBetween[2],c.charsBetween=c.charsBetween[1].split("").reverse().join(""));return c}function e(a){setTimeout(function(){a.state.completionActive||CodeMirror.showHint(a,b,{hintsClass:"toolbar-modifier",completeSingle:!1})},100);return CodeMirror.Pass}var k=this;this._createToolbar();this.toolbarContainer&&this.mainContainer.append(this.toolbarContainer);h.prototype._createModifier.call(this);
this._setupActualConfig(a);a=this.actualConfig.toolbar;a=CKEDITOR.tools.isArray(a)?"\tconfig.toolbar = "+("[\n\t\t"+f.map(a,function(a){return h.stringifyJSONintoOneLine(a,{addSpaces:!0,noQuotesOnKey:!0,singleQuotes:!0})}).join(",\n\t\t")+"\n\t]")+";":"config.toolbar = [];";a=["CKEDITOR.editorConfig = function( config ) {\n",a,"\n};"].join("");var p=new CKEDITOR.dom.element("div");p.addClass("codemirror-wrapper");this.modifyContainer.append(p);this.codeContainer=CodeMirror(p.$,{mode:{name:"javascript",
json:!0},lineNumbers:!1,lineWrapping:!0,viewportMargin:Infinity,value:a,smartIndent:!1,indentWithTabs:!0,indentUnit:4,tabSize:4,theme:"neo",extraKeys:{Left:e,Right:e,"'''":e,"'\"'":e,Backspace:e,Delete:e,"Shift-Tab":"indentLess"}});this.codeContainer.on("endCompletion",function(a,b){var g=c(a);void 0!==b&&a.replaceSelection(g.endChar)});this.codeContainer.on("change",function(){var a=k.codeContainer.getValue(),a=k._evaluateValue(a);null!==a?(k.actualConfig.toolbar=a.toolbar?a.toolbar:k.actualConfig.toolbar,
k._fillHintByUnusedElements(),k._refreshEditor(),k.mainContainer.removeClass("invalid")):k.mainContainer.addClass("invalid")});this.hintContainer=new CKEDITOR.dom.element("div");this.hintContainer.addClass("toolbarModifier-hints");this._fillHintByUnusedElements();this.hintContainer.insertBefore(p)};b.prototype._fillHintByUnusedElements=function(){var a=this.getUnusedButtonsArray(this.actualConfig.toolbar,!0),a=this.groupButtonNamesByGroup(a),b=f.map(a,function(a){var b=f.map(a.buttons,function(a){return"<code>"+
a+"</code> "}).join("");return["<dt><code>",a.name,"</code></dt><dd>",b,"</dd>"].join("")}).join(" "),d='<dt class="list-header">Toolbar group</dt><dd class="list-header">Unused items</dd>';a.length||(d="<p>All items are in use.</p>");this.codeContainer.refresh();this.hintContainer.setHtml("<h3>Unused toolbar items</h3><dl>"+d+b+"</dl>")};b.prototype.getToolbarGroupByButtonName=function(a){var b=this.fullToolbarEditor.buttonNamesByGroup,d;for(d in b)for(var c=b[d],e=c.length;e--;)if(a===c[e])return d;
return null};b.prototype.getUnusedButtonsArray=function(a,g,d){g=!0===g?!0:!1;var c=b.mapToolbarCfgToElementsList(a);a=Object.keys(this.fullToolbarEditor.editorInstance.ui.items);a=f.filter(a,function(a){var b="-"===a;a=void 0===d||0===a.toLowerCase().indexOf(d.toLowerCase());return!b&&a});a=f.filter(a,function(a){return-1==CKEDITOR.tools.indexOf(c,a)});g&&a.sort();return a};b.prototype.groupButtonNamesByGroup=function(a){var b=[],d=JSON.parse(JSON.stringify(this.fullToolbarEditor.buttonNamesByGroup)),
c;for(c in d){var e=d[c],e=f.filter(e,function(b){return-1!==CKEDITOR.tools.indexOf(a,b)});e.length&&b.push({name:c,buttons:e})}return b};b.mapToolbarCfgToElementsList=function(a){function b(a){return"-"!==a}for(var d=[],c=a.length,e=0;e<c;e+=1)a[e]&&"string"!==typeof a[e]&&(d=d.concat(f.filter(a[e].items,b)));return d};b.prototype._setupActualConfig=function(a){a=a||this.editorInstance.config;CKEDITOR.tools.isArray(a.toolbar)||(a.toolbarGroups||(a.toolbarGroups=this.fullToolbarEditor.getFullToolbarGroupsConfig(!0)),
this._fixGroups(a),a.toolbar=this._mapToolbarGroupsToToolbar(a.toolbarGroups,this.actualConfig.removeButtons),this.actualConfig.toolbar=a.toolbar,this.actualConfig.removeButtons="")};b.prototype._mapToolbarGroupsToToolbar=function(a,b){b=b||this.editorInstance.config.removedBtns;b="string"==typeof b?b.split(","):[];for(var d=a.length;d--;){var c=this._mapToolbarSubgroup(a[d],b);"separator"===a[d].type?a[d]="/":CKEDITOR.tools.isArray(c)&&0===c.length?a.splice(d,1):a[d]="string"==typeof c?c:{name:a[d].name,
items:c}}return a};b.prototype._mapToolbarSubgroup=function(a,b){if("string"==typeof a)return a;for(var d=a.groups?a.groups.length:0,c=[],e=0;e<d;e+=1){var g=a.groups[e],g=this.fullToolbarEditor.buttonsByGroup["string"===typeof g?g:g.name]||[],g=this._mapButtonsToButtonsNames(g,b),f=g.length,c=c.concat(g);f&&c.push("-")}"-"==c[c.length-1]&&c.pop();return c};b.prototype._mapButtonsToButtonsNames=function(a,b){for(var d=a.length;d--;){var c=a[d],c="string"===typeof c?c:this.fullToolbarEditor.getCamelCasedButtonName(c.name);
-1!==CKEDITOR.tools.indexOf(b,c)?a.splice(d,1):a[d]=c}return a};b.prototype._evaluateValue=function(a){var b;try{var d={};Function("var CKEDITOR = {}; "+a+"; return CKEDITOR;")().editorConfig(d);b=d;for(var c=b.toolbar.length;c--;)b.toolbar[c]||b.toolbar.splice(c,1)}catch(e){b=null}return b};b.prototype.mapToolbarToToolbarGroups=function(a){function b(a,b){a=a.slice();for(var c=b.length;c--;){var d=a.indexOf(b[c]);-1!==d&&a.splice(d,1)}return a}for(var d={},c=[],e=[],c=a.length,f=0;f<c;f++)if("/"===
a[f])e.push("/");else{var h=a[f].items,m={};m.name=a[f].name;m.groups=[];for(var r=h.length,q=0;q<r;q++){var n=h[q];if("-"!==n){var l=this.getToolbarGroupByButtonName(n);-1===m.groups.indexOf(l)&&m.groups.push(l);d[l]=d[l]||{};l=d[l].buttons=d[l].buttons||{};l[n]=l[n]||{used:0,origin:m.name};l[n].used++}}e.push(m)}c=function(a,c){var d=[],e;for(e in a)var f=a[e],g=c[e].slice(),d=d.concat(b(g,Object.keys(f.buttons)));return d}(d,this.fullToolbarEditor.buttonNamesByGroup);return{toolbarGroups:e,removeButtons:c.join(",")}};
return b})();
