var $jscomp={scope:{},findInternal:function(b,g,a){b instanceof String&&(b=String(b));for(var c=b.length,d=0;d<c;d++){var e=b[d];if(g.call(a,e,d,b))return{i:d,v:e}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,g,a){if(a.get||a.set)throw new TypeError("ES3 does not support getters and setters.");b!=Array.prototype&&b!=Object.prototype&&(b[g]=a.value)};
$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(b,g,a,c){if(g){a=$jscomp.global;b=b.split(".");for(c=0;c<b.length-1;c++){var d=b[c];d in a||(a[d]={});a=a[d]}b=b[b.length-1];c=a[b];g=g(c);g!=c&&null!=g&&$jscomp.defineProperty(a,b,{configurable:!0,writable:!0,value:g})}};
$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,a){return $jscomp.findInternal(this,b,a).v}},"es6-impl","es3");
(function(){function b(a,c){g.call(this,a,c);this.actualConfig=this.originalConfig=this.removedButtons=null;this.emptyVisible=!1;this.state="edit";this.toolbarButtons=[{text:{active:"Hide empty toolbar groups",inactive:"Show empty toolbar groups"},group:"edit",position:"left",cssClass:"button-a-soft",clickCallback:function(a,c){a[a.hasClass("button-a-background")?"removeClass":"addClass"]("button-a-background");this._toggleVisibilityEmptyElements();this.emptyVisible?a.setText(c.text.active):a.setText(c.text.inactive)}},
{text:"Add row separator",group:"edit",position:"left",cssClass:"button-a-soft",clickCallback:function(){this._addSeparator()}},{text:"Select config",group:"config",position:"left",cssClass:"button-a-soft",clickCallback:function(){this.configContainer.findOne("textarea").$.select()}},{text:"Back to configurator",group:"config",position:"right",cssClass:"button-a-background",clickCallback:function(){if("paste"===this.state){var a=this.configContainer.findOne("textarea").getValue();(a=b.evaluateToolbarGroupsConfig(a))?
this.setConfig(a):alert("Your pasted config is wrong.")}this.state="edit";this._showConfigurationTool();this.showToolbarBtnsByGroupName(this.state)}},{text:'Get toolbar <span class="highlight">config</span>',group:"edit",position:"right",cssClass:"button-a-background icon-pos-left icon-download",clickCallback:function(){this.state="config";this._showConfig();this.showToolbarBtnsByGroupName(this.state)}}];this.cachedActiveElement=null}var g=ToolbarConfigurator.AbstractToolbarModifier;ToolbarConfigurator.ToolbarModifier=
b;b.prototype=Object.create(ToolbarConfigurator.AbstractToolbarModifier.prototype);b.prototype.getActualConfig=function(){var a=g.prototype.getActualConfig.call(this);if(a.toolbarGroups)for(var c=a.toolbarGroups.length,d=0;d<c;d+=1)a.toolbarGroups[d]=b.parseGroupToConfigValue(a.toolbarGroups[d]);return a};b.prototype._onInit=function(a,c,d){d=!0===d;g.prototype._onInit.call(this,void 0,c);this.removedButtons=[];d?this.removedButtons=this.actualConfig.removeButtons?this.actualConfig.removeButtons.split(","):
[]:"removeButtons"in this.originalConfig?this.removedButtons=this.originalConfig.removeButtons?this.originalConfig.removeButtons.split(","):[]:(this.originalConfig.removeButtons="",this.removedButtons=[]);this.actualConfig.toolbarGroups||(this.actualConfig.toolbarGroups=this.fullToolbarEditor.getFullToolbarGroupsConfig());this._fixGroups(this.actualConfig);this._calculateTotalBtns();this._createModifier();this._refreshMoveBtnsAvalibility();this._refreshBtnTabIndexes();"function"===typeof a&&a(this.mainContainer)};
b.prototype._showConfigurationTool=function(){this.configContainer.addClass("hidden");this.modifyContainer.removeClass("hidden")};b.prototype._showConfig=function(){var a=this.getActualConfig(),c,d;if(a.toolbarGroups){c=a.toolbarGroups;for(var e=this.cfg.trimEmptyGroups,f=[],k=c.length,m=0;m<k;m++){var h=c[m];if("/"===h)f.push("'/'");else{if(e)for(var l=h.groups.length;l--;)0===b.getTotalSubGroupButtonsNumber(h.groups[l],this.fullToolbarEditor)&&h.groups.splice(l,1);e&&0===h.groups.length||f.push(g.stringifyJSONintoOneLine(h,
{addSpaces:!0,noQuotesOnKey:!0,singleQuotes:!0}))}}c="\n\t\t"+f.join(",\n\t\t")}a.removeButtons&&(d=a.removeButtons);a=['<textarea class="configCode" readonly>CKEDITOR.editorConfig = function( config ) {\n',c?"\tconfig.toolbarGroups = ["+c+"\n\t];":"",d?"\n\n":"",d?"\tconfig.removeButtons = '"+d+"';":"","\n};</textarea>"].join("");this.modifyContainer.addClass("hidden");this.configContainer.removeClass("hidden");this.configContainer.setHtml(a)};b.prototype._toggleVisibilityEmptyElements=function(){this.modifyContainer.hasClass("empty-visible")?
(this.modifyContainer.removeClass("empty-visible"),this.emptyVisible=!1):(this.modifyContainer.addClass("empty-visible"),this.emptyVisible=!0);this._refreshMoveBtnsAvalibility()};b.prototype._createModifier=function(){function a(){c._highlightGroup(this.data("name"))}var c=this;g.prototype._createModifier.call(this);this.modifyContainer.setHtml(this._toolbarConfigToListString());var d=this.modifyContainer.find('li[data-type="group"]');this.modifyContainer.on("mouseleave",function(){this._dehighlightActiveToolGroup()},
this);for(var e=d.count(),f=0;f<e;f+=1)d.getItem(f).on("mouseenter",a);CKEDITOR.document.on("keypress",function(a){a=a.data.$.keyCode;a=32===a||13===a;var d=new CKEDITOR.dom.element(CKEDITOR.document.$.activeElement);d.getAscendant(function(a){return a.$===c.mainContainer.$})&&a&&"button"===d.data("type")&&d.findOne("input").$.click()});this.modifyContainer.on("click",function(a){var d=a.data.$,e=new CKEDITOR.dom.element(d.target||d.srcElement);if(a=b.getGroupOrSeparatorLiAncestor(e)){c.cachedActiveElement=
document.activeElement;if(e.$ instanceof HTMLInputElement)c._handleCheckboxClicked(e);else if(e.$ instanceof HTMLButtonElement&&(d.preventDefault?d.preventDefault():d.returnValue=!1,(d=c._handleAnchorClicked(e.$))&&"remove"==d.action))return;d=a.data("type");a=a.data("name");c._setActiveElement(d,a);c.cachedActiveElement&&c.cachedActiveElement.focus()}});this.toolbarContainer||(this._createToolbar(),this.toolbarContainer.insertBefore(this.mainContainer.getChildren().getItem(0)));this.showToolbarBtnsByGroupName("edit");
this.configContainer||(this.configContainer=new CKEDITOR.dom.element("div"),this.configContainer.addClass("configContainer"),this.configContainer.addClass("hidden"),this.mainContainer.append(this.configContainer));return this.mainContainer};b.prototype.showToolbarBtnsByGroupName=function(a){if(this.toolbarContainer)for(var c=this.toolbarContainer.find("button"),d=c.count(),b=0;b<d;b+=1){var f=c.getItem(b);f.data("group")==a?f.removeClass("hidden"):f.addClass("hidden")}};b.parseGroupToConfigValue=
function(a){if("separator"==a.type)return"/";var c=a.groups,d=c.length;delete a.totalBtns;for(var b=0;b<d;b+=1)c[b]=c[b].name;return a};b.getGroupOrSeparatorLiAncestor=function(a){return a.$ instanceof HTMLLIElement&&"group"==a.data("type")?a:b.getFirstAncestor(a,function(a){a=a.data("type");return"group"==a||"separator"==a})};b.prototype._setActiveElement=function(a,c){this.currentActive&&this.currentActive.elem.removeClass("active");if(null===a)this._dehighlightActiveToolGroup(),this.currentActive=
null;else{var d=this.mainContainer.findOne('ul[data-type=table-body] li[data-type="'+a+'"][data-name="'+c+'"]');d.addClass("active");this.currentActive={type:a,name:c,elem:d};"group"==a&&this._highlightGroup(c);"separator"==a&&this._dehighlightActiveToolGroup()}};b.prototype.getActiveToolGroup=function(){return this.editorInstance.container?this.editorInstance.container.findOne(".cke_toolgroup.active, .cke_toolbar.active"):null};b.prototype._dehighlightActiveToolGroup=function(){var a=this.getActiveToolGroup();
a&&a.removeClass("active");this.editorInstance.container&&this.editorInstance.container.removeClass("some-toolbar-active")};b.prototype._highlightGroup=function(a){this.editorInstance.container&&(a=this.getFirstEnabledButtonInGroup(a),a=this.editorInstance.container.findOne(".cke_button__"+a+", .cke_combo__"+a),this._dehighlightActiveToolGroup(),this.editorInstance.container&&this.editorInstance.container.addClass("some-toolbar-active"),a&&(a=b.getFirstAncestor(a,function(a){return a.hasClass("cke_toolbar")}))&&
a.addClass("active"))};b.prototype.getFirstEnabledButtonInGroup=function(a){var c=this.actualConfig.toolbarGroups;a=this.getGroupIndex(a);c=c[a];if(-1===a)return null;a=c.groups?c.groups.length:0;for(var d=0;d<a;d+=1){var b=this.getFirstEnabledButtonInSubgroup(c.groups[d].name);if(b)return b}return null};b.prototype.getFirstEnabledButtonInSubgroup=function(a){for(var c=(a=this.fullToolbarEditor.buttonsByGroup[a])?a.length:0,d=0;d<c;d+=1){var b=a[d].name;if(!this.isButtonRemoved(b))return b}return null};
b.prototype._handleCheckboxClicked=function(a){var c=a.getAscendant("li").data("name");a.$.checked?this._removeButtonFromRemoved(c):this._addButtonToRemoved(c)};b.prototype._handleAnchorClicked=function(a){a=new CKEDITOR.dom.element(a);var c=a.getAscendant("li"),d=c.getAscendant("ul"),b=c.data("type"),f=c.data("name"),k=a.data("direction"),g="up"===k?c.getPrevious():c.getNext(),h;if(a.hasClass("disabled"))return null;if(a.hasClass("remove"))return c.remove(),this._removeSeparator(c.data("name")),
this._setActiveElement(null),{action:"remove"};if(!a.hasClass("move")||!g)return{action:null};if("group"===b||"separator"===b)h=this._moveGroup(k,f);"subgroup"===b&&(h=c.getAscendant("li").data("name"),h=this._moveSubgroup(k,h,f));"up"===k&&c.insertBefore(d.getChild(h));"down"===k&&c.insertAfter(d.getChild(h));for(var l;c="up"===k?c.getPrevious():c.getNext();)if(this.emptyVisible||!c.hasClass("empty")){l=c;break}l||(l='[data-direction="'+("up"===k?"down":"up")+'"]',this.cachedActiveElement=a.getParent().findOne(l));
this._refreshMoveBtnsAvalibility();this._refreshBtnTabIndexes();return{action:"move"}};b.prototype._refreshMoveBtnsAvalibility=function(){function a(a){var d=a.count();for(f=0;f<d;f+=1)c._disableElementsInList(a.getItem(f))}for(var c=this,d=this.mainContainer.find("ul[data-type=table-body] li > p > span > button.move.disabled"),b=d.count(),f=0;f<b;f+=1)d.getItem(f).removeClass("disabled");a(this.mainContainer.find("ul[data-type=table-body]"));a(this.mainContainer.find("ul[data-type=table-body] > li > ul"))};
b.prototype._refreshBtnTabIndexes=function(){for(var a=this.mainContainer.find('[data-tab="true"]'),c=a.count(),d=0;d<c;d++){var b=a.getItem(d),f=b.hasClass("disabled");b.setAttribute("tabindex",f?-1:d)}};b.prototype._disableElementsInList=function(a){function c(a){return!a.hasClass("empty")}if(a.getChildren().count()){var d;this.emptyVisible?(d=a.getFirst(),a=a.getLast()):(d=a.getFirst(c),a=a.getLast(c));if(d)var b=d.findOne('p button[data-direction="up"]');if(a)var f=a.findOne('p button[data-direction="down"]');
b&&(b.addClass("disabled"),b.setAttribute("tabindex","-1"));f&&(f.addClass("disabled"),f.setAttribute("tabindex","-1"))}};b.prototype.getGroupIndex=function(a){for(var c=this.actualConfig.toolbarGroups,d=c.length,b=0;b<d;b+=1)if(c[b].name===a)return b;return-1};b.prototype._addSeparator=function(){var a=this._determineSeparatorToAddIndex(),c=b.createSeparatorLiteral(),d=CKEDITOR.dom.element.createFromHtml(b.getToolbarSeparatorString(c));this.actualConfig.toolbarGroups.splice(a,0,c);d.insertBefore(this.modifyContainer.findOne("ul[data-type=table-body]").getChild(a));
this._setActiveElement("separator",c.name);this._refreshMoveBtnsAvalibility();this._refreshBtnTabIndexes();this._refreshEditor()};b.prototype._removeSeparator=function(a){var c=CKEDITOR.tools.indexOf(this.actualConfig.toolbarGroups,function(c){return"separator"==c.type&&c.name==a});this.actualConfig.toolbarGroups.splice(c,1);this._refreshMoveBtnsAvalibility();this._refreshBtnTabIndexes();this._refreshEditor()};b.prototype._determineSeparatorToAddIndex=function(){return this.currentActive?("group"==
this.currentActive.elem.data("type")||"separator"==this.currentActive.elem.data("type")?this.currentActive.elem:this.currentActive.elem.getAscendant("li")).getIndex():0};b.prototype._moveElement=function(a,c,d){function e(a){return a.totalBtns||"separator"==a.type}d=this.emptyVisible?"down"==d?c+1:c-1:b.getFirstElementIndexWith(a,c,d,e);return b.moveTo(d-c,a,c)};b.prototype._moveGroup=function(a,c){var b=this.getGroupIndex(c),b=this._moveElement(this.actualConfig.toolbarGroups,b,a);this._refreshMoveBtnsAvalibility();
this._refreshBtnTabIndexes();this._refreshEditor();return b};b.prototype._moveSubgroup=function(a,c,b){c=this.getGroupIndex(c);c=this.actualConfig.toolbarGroups[c];var d=CKEDITOR.tools.indexOf(c.groups,function(a){return a.name==b});a=this._moveElement(c.groups,d,a);this._refreshEditor();return a};b.prototype._calculateTotalBtns=function(){for(var a=this.actualConfig.toolbarGroups,c=a.length;c--;){var d=a[c],e=b.getTotalGroupButtonsNumber(d,this.fullToolbarEditor);"separator"!=d.type&&(d.totalBtns=
e)}};b.prototype._addButtonToRemoved=function(a){if(-1!=CKEDITOR.tools.indexOf(this.removedButtons,a))throw"Button already added to removed";this.removedButtons.push(a);this.actualConfig.removeButtons=this.removedButtons.join(",");this._refreshEditor()};b.prototype._removeButtonFromRemoved=function(a){a=CKEDITOR.tools.indexOf(this.removedButtons,a);if(-1===a)throw"Trying to remove button from removed, but not found";this.removedButtons.splice(a,1);this.actualConfig.removeButtons=this.removedButtons.join(",");
this._refreshEditor()};b.parseGroupToConfigValue=function(a){if("separator"==a.type)return"/";var c=a.groups,b=c.length;delete a.totalBtns;for(var e=0;e<b;e+=1)c[e]=c[e].name;return a};b.getGroupOrSeparatorLiAncestor=function(a){return a.$ instanceof HTMLLIElement&&"group"==a.data("type")?a:b.getFirstAncestor(a,function(a){a=a.data("type");return"group"==a||"separator"==a})};b.createSeparatorLiteral=function(){return{type:"separator",name:"separator"+CKEDITOR.tools.getNextNumber()}};b.prototype._toolbarConfigToListString=
function(){for(var a=this.actualConfig.toolbarGroups||[],c='<ul data-type="table-body">',d=a.length,e=0;e<d;e+=1)var f=a[e],c="separator"===f.type?c+b.getToolbarSeparatorString(f):c+this._getToolbarGroupString(f);c+="</ul>";return b.getToolbarHeaderString()+c};b.prototype._getToolbarGroupString=function(a){var c=a.groups,d;d=""+['<li data-type="group" data-name="',a.name,'" ',a.totalBtns?"":'class="empty"',">"].join("");d+=b.getToolbarElementPreString(a)+"<ul>";a=c.length;for(var e=0;e<a;e+=1){var f=
c[e];d+=this._getToolbarSubgroupString(f,this.fullToolbarEditor.buttonsByGroup[f.name])}return d+"</ul></li>"};b.getToolbarSeparatorString=function(a){return['<li data-type="',a.type,'" data-name="',a.name,'">',b.getToolbarElementPreString("row separator"),"</li>"].join("")};b.getToolbarHeaderString=function(){return'<ul data-type="table-header"><li data-type="header"><p>Toolbars</p><ul><li><p>Toolbar groups</p><p>Toolbar group items</p></li></ul></li></ul>'};b.getFirstAncestor=function(a,c){for(var b=
a.getParents(),e=b.length;e--;)if(c(b[e]))return b[e];return null};b.getFirstElementIndexWith=function(a,c,b,e){for(;"up"===b?c--:++c<a.length;)if(e(a[c]))return c;return-1};b.moveTo=function(a,c,b){var d;-1!==b&&(d=c.splice(b,1)[0]);a=b+a;c.splice(a,0,d);return a};b.getTotalSubGroupButtonsNumber=function(a,b){var c=b.buttonsByGroup["string"==typeof a?a:a.name];return c?c.length:0};b.getTotalGroupButtonsNumber=function(a,c){for(var d=0,e=a.groups,f=e?e.length:0,g=0;g<f;g+=1)d+=b.getTotalSubGroupButtonsNumber(e[g],
c);return d};b.prototype._getToolbarSubgroupString=function(a,c){var d;d=""+['<li data-type="subgroup" data-name="',a.name,'" ',a.totalBtns?"":'class="empty" ',">"].join("");d+=b.getToolbarElementPreString(a.name);d+="<ul>";for(var e=c?c.length:0,f=0;f<e;f+=1)d+=this.getButtonString(c[f]);return d+"</ul></li>"};b.prototype._getConfigButtonName=function(a){var b=this.fullToolbarEditor.editorInstance.ui.items,d;for(d in b)if(b[d].name==a)return d;return null};b.prototype.isButtonRemoved=function(a){return-1!=
CKEDITOR.tools.indexOf(this.removedButtons,this._getConfigButtonName(a))};b.prototype.getButtonString=function(a){var b=this.isButtonRemoved(a.name)?"":'checked="checked"';return['<li data-tab="true" data-type="button" data-name="',this._getConfigButtonName(a.name),'"><label title="',a.label,'" ><input tabindex="-1"type="checkbox"',b,"/>",a.$.getOuterHtml(),"</label></li>"].join("")};b.getToolbarElementPreString=function(a){a=a.name?a.name:a;return['<p><span><button title="Move element upward" data-tab="true" data-direction="up" class="move icon-up-big"></button><button title="Move element downward" data-tab="true" data-direction="down" class="move icon-down-big"></button>',
"row separator"==a?'<button title="Remove element" data-tab="true" class="remove icon-trash"></button>':"",a,"</span></p>"].join("")};b.evaluateToolbarGroupsConfig=function(a){return a=function(a){var b={},c;try{c=eval("("+a+")")}catch(f){try{c=eval(a)}catch(k){return null}}return b.toolbarGroups&&"number"===typeof b.toolbarGroups.length?JSON.stringify(b):c&&"number"===typeof c.length?JSON.stringify({toolbarGroups:c}):c&&c.toolbarGroups?JSON.stringify(c):null}(a)};return b})();
