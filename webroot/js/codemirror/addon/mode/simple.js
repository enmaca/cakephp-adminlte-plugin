(function(l){"object"==typeof exports&&"object"==typeof module?l(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],l):l(CodeMirror)})(function(l){function r(d,e){if(!d.hasOwnProperty(e))throw Error("Undefined state "+e+" in simple mode");}function q(d,e){if(!d)return/(?:)/;var b="";d instanceof RegExp?(d.ignoreCase&&(b="i"),d=d.source):d=String(d);return new RegExp((!1===e?"":"^")+"(?:"+d+")",b)}function u(d,e){(d.next||d.push)&&r(e,d.next||d.push);
this.regex=q(d.regex);var b;if(b=d.token)if("string"==typeof b)b=b.replace(/\./g," ");else{for(var a=[],c=0;c<b.length;c++)a.push(b[c]&&b[c].replace(/\./g," "));b=a}else b=null;this.token=b;this.data=d}function v(d,e){return function(b,a){if(a.pending){var c=a.pending.shift();0==a.pending.length&&(a.pending=null);b.pos+=c.text.length;return c.token}if(a.local){if(a.local.end&&b.match(a.local.end))c=a.local.endToken||null,a.local=a.localState=null;else{var c=a.local.mode.token(b,a.localState),f;a.local.endScan&&
(f=a.local.endScan.exec(b.current()))&&(b.pos=b.start+f.index)}return c}for(var g=d[a.state],h=0;h<g.length;h++)if(c=g[h],f=(!c.data.sol||b.sol())&&b.match(c.regex)){c.data.next?a.state=c.data.next:c.data.push?((a.stack||(a.stack=[])).push(a.state),a.state=c.data.push):c.data.pop&&a.stack&&a.stack.length&&(a.state=a.stack.pop());if(c.data.mode){var g=void 0,m=e,h=a,k=c.data.mode,n=c.token;if(k.persistent)for(var p=h.persistentStates;p&&!g;p=p.next)if(k.spec?t(k.spec,p.spec):k.mode==p.mode)g=p;m=g?
g.mode:k.mode||l.getMode(m,k.spec);p=g?g.state:l.startState(m);k.persistent&&!g&&(h.persistentStates={mode:m,spec:k.spec,state:p,next:h.persistentStates});h.localState=p;h.local={mode:m,end:k.end&&q(k.end),endScan:k.end&&!1!==k.forceEnd&&q(k.end,!1),endToken:n&&n.join?n[n.length-1]:n}}c.data.indent&&a.indent.push(b.indentation()+e.indentUnit);c.data.dedent&&a.indent.pop();if(2<f.length){a.pending=[];for(g=2;g<f.length;g++)f[g]&&a.pending.push({text:f[g],token:c.token[g-1]});b.backUp(f[0].length-(f[1]?
f[1].length:0));return c.token[0]}return c.token&&c.token.join?c.token[0]:c.token}b.next();return null}}function t(d,e){if(d===e)return!0;if(!d||"object"!=typeof d||!e||"object"!=typeof e)return!1;var b=0,a;for(a in d)if(d.hasOwnProperty(a)){if(!e.hasOwnProperty(a)||!t(d[a],e[a]))return!1;b++}for(a in e)e.hasOwnProperty(a)&&b--;return 0==b}function w(d,e){return function(b,a,c){if(b.local&&b.local.mode.indent)return b.local.mode.indent(b.localState,a,c);if(!(c=null==b.indent||b.local)&&(c=e.dontIndentStates)){a:{c=
e.dontIndentStates;for(var f=0;f<c.length;f++)if(c[f]===b.state){c=!0;break a}c=void 0}c=-1<c}if(c)return l.Pass;c=b.indent.length-1;f=d[b.state];a:for(;;){for(var g=0;g<f.length;g++){var h=f[g];if(h.data.dedent&&!1!==h.data.dedentIfLineStart){var m=h.regex.exec(a);if(m&&m[0]){c--;if(h.next||h.push)f=d[h.next||h.push];a=a.slice(m[0].length);continue a}}}break}return 0>c?0:b.indent[c]}}l.defineSimpleMode=function(d,e){l.defineMode(d,function(b){return l.simpleMode(b,e)})};l.simpleMode=function(d,e){r(e,
"start");var b={},a=e.meta||{},c=!1,f;for(f in e)if(f!=a&&e.hasOwnProperty(f))for(var g=b[f]=[],h=e[f],m=0;m<h.length;m++){var k=h[m];g.push(new u(k,e));if(k.indent||k.dedent)c=!0}b={startState:function(){return{state:"start",pending:null,local:null,localState:null,indent:c?[]:null}},copyState:function(a){var b={state:a.state,pending:a.pending,local:a.local,localState:null,indent:a.indent&&a.indent.slice(0)};a.localState&&(b.localState=l.copyState(a.local.mode,a.localState));a.stack&&(b.stack=a.stack.slice(0));
for(var c=a.persistentStates;c;c=c.next)b.persistentStates={mode:c.mode,spec:c.spec,state:c.state==a.localState?b.localState:l.copyState(c.mode,c.state),next:b.persistentStates};return b},token:v(b,d),innerMode:function(a){return a.local&&{mode:a.local.mode,state:a.localState}},indent:w(b,a)};if(a)for(var n in a)a.hasOwnProperty(n)&&(b[n]=a[n]);return b}});
