(function(l){"object"==typeof exports&&"object"==typeof module?l(require("../../lib/codemirror"),require("../../mode/sql/sql")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../../mode/sql/sql"],l):l(CodeMirror)})(function(l){function v(a){return"[object Array]"==Object.prototype.toString.call(a)}function F(a){a=a.doc.modeOption;"sql"===a&&(a="text/x-sql");return l.resolveMode(a).keywords}function G(a){a=a.doc.modeOption;"sql"===a&&(a="text/x-sql");return l.resolveMode(a).identifierQuote||
"`"}function u(a){return"string"==typeof a?a:a.text}function y(a,b){v(b)&&(b={columns:b});b.text||(b.text=a);return b}function H(a){var b={};if(v(a))for(var c=a.length-1;0<=c;c--){var d=a[c];b[u(d).toUpperCase()]=y(u(d),d)}else if(a)for(c in a)b[c.toUpperCase()]=y(c,a[c]);return b}function z(a){var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function A(a,b){var c=a.length,c=u(b).substr(0,c);return a.toUpperCase()===c.toUpperCase()}function r(a,b,c,d){if(v(c))for(var f=0;f<c.length;f++)A(b,
c[f])&&a.push(d(c[f]));else for(f in c)if(c.hasOwnProperty(f)){var e=c[f],e=e&&!0!==e?e.displayText?{text:e.text,displayText:e.displayText}:e.text:f;A(b,e)&&a.push(d(e))}}function I(a){"."==a.charAt(0)&&(a=a.substr(1));a=a.split(h+h);for(var b=0;b<a.length;b++)a[b]=a[b].replace(new RegExp(h,"g"),"");return a.join(h)}function w(a){for(var b=u(a).split("."),c=0;c<b.length;c++)b[c]=h+b[c].replace(new RegExp(h,"g"),h+h)+h;b=b.join(".");if("string"==typeof a)return b;a=z(a);a.text=b;return a}function J(a,
b,c,d){for(var f=!1,e=[],B=b.start,k=!0;k;)k="."==b.string.charAt(0),f=f||b.string.charAt(0)==h,B=b.start,e.unshift(I(b.string)),b=d.getTokenAt(p(a.line,b.start)),"."==b.string&&(k=!0,b=d.getTokenAt(p(a.line,b.start)));a=e.join(".");r(c,a,q,function(a){return f?w(a):a});r(c,a,m,function(a){return f?w(a):a});a=e.pop();var g=e.join("."),t=!1,n=g;q[g.toUpperCase()]||(e=g,g=C(g,d),g!==e&&(t=!0));(d=q[g.toUpperCase()])&&d.columns&&(d=d.columns);d&&r(c,a,d,function(a){var b=g;1==t&&(b=n);"string"==typeof a?
a=b+"."+a:(a=z(a),a.text=b+"."+a.text);return f?w(a):a});return B}function K(a,b){if(a)for(var c=/[,;]/g,d=a.split(" "),f=0;f<d.length;f++)b(d[f]?d[f].replace(c,""):"")}function C(a,b){for(var c=b.doc,d=c.getValue(),f=a.toUpperCase(),e="",h="",k=[],g=p(0,0),t=p(b.lastLine(),b.getLineHandle(b.lastLine()).length),n=d.indexOf(x.QUERY_DIV);-1!=n;)k.push(c.posFromIndex(n)),n=d.indexOf(x.QUERY_DIV,n+1);k.unshift(p(0,0));k.push(p(b.lastLine(),b.getLineHandle(b.lastLine()).text.length));for(var n=null,m=
b.getCursor(),d=0;d<k.length;d++){if((null==n||0<D(m,n))&&0>=D(m,k[d])){g=n;t=k[d];break}n=k[d]}c=c.getRange(g,t,!1);for(d=0;d<c.length&&(K(c[d],function(a){var b=a.toUpperCase();b===f&&q[e.toUpperCase()]&&(h=e);b!==x.ALIAS_KEYWORD&&(e=a)}),!h);d++);return h}var q,m,E,h,x={QUERY_DIV:";",ALIAS_KEYWORD:"AS"},p=l.Pos,D=l.cmpPos;l.registerHelper("hint","sql",function(a,b){q=H(b&&b.tables);var c=b&&b.defaultTable,d=b&&b.disableKeywords;m=c&&q[c.toUpperCase()];E=F(a);h=G(a);c&&!m&&(m=C(c,a));m=m||[];m.columns&&
(m=m.columns);var c=a.getCursor(),f=[],e=a.getTokenAt(c),l,k,g;e.end>c.ch&&(e.end=c.ch,e.string=e.string.slice(0,c.ch-e.start));e.string.match(/^[.`"\w@]\w*$/)?(g=e.string,l=e.start,k=e.end):(l=k=c.ch,g="");"."==g.charAt(0)||g.charAt(0)==h?l=J(c,e,f,a):(r(f,g,q,function(a){return a}),r(f,g,m,function(a){return a}),d||r(f,g,E,function(a){return a.toUpperCase()}));return{list:f,from:p(c.line,l),to:p(c.line,k)}})});
